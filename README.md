# TFBoys - AWSåŸºç¡€è®¾æ–½Terraformé¡¹ç›®

## é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªç”¨äºå­¦ä¹ å’Œæ¼”ç¤ºçš„æ¨¡å—åŒ–Terraformé¡¹ç›®ï¼Œç”¨äºåœ¨AWSä¸Šéƒ¨ç½²å®Œæ•´çš„ä¸‰å±‚åº”ç”¨æ¶æ„ã€‚é¡¹ç›®åç§°"tfboys"æ¥è‡ªäºTerraform Boysçš„ç¼©å†™ï¼Œæ˜¯ä¸€ä¸ªåŸºç¡€è®¾æ–½å³ä»£ç (IaC)çš„å®è·µé¡¹ç›®ã€‚

## æ¶æ„ç»„ä»¶

### ğŸŒ ç½‘ç»œå±‚ (VPCæ¨¡å—)

- **VPC**: åˆ›å»ºéš”ç¦»çš„è™šæ‹Ÿç§æœ‰äº‘
- **å…¬æœ‰å­ç½‘**: ç”¨äºéƒ¨ç½²é¢å‘äº’è”ç½‘çš„èµ„æºï¼ˆå¦‚EC2å®ä¾‹ï¼‰
- **ç§æœ‰å­ç½‘**: ç”¨äºéƒ¨ç½²æ•°æ®åº“ç­‰åç«¯èµ„æº
- **Internet Gateway**: æä¾›äº’è”ç½‘è®¿é—®
- **è·¯ç”±è¡¨**: é…ç½®ç½‘ç»œè·¯ç”±è§„åˆ™

### ğŸ”’ å®‰å…¨å±‚ (Securityæ¨¡å—)

- **APIå®‰å…¨ç»„**: å…è®¸HTTP(80)ã€HTTPS(443)å’ŒSSH(22)è®¿é—®
- **æ•°æ®åº“å®‰å…¨ç»„**: åªå…è®¸æ¥è‡ªAPIå®‰å…¨ç»„çš„PostgreSQL(5432)è¿æ¥

### ğŸ’» è®¡ç®—å±‚ (EC2æ¨¡å—)

- **EC2å®ä¾‹**: Amazon Linux 2å®ä¾‹ä½œä¸ºåº”ç”¨æœåŠ¡å™¨
- **å¯†é’¥å¯¹ç®¡ç†**: è‡ªåŠ¨ç”ŸæˆSSHå¯†é’¥å¯¹ç”¨äºå®‰å…¨è®¿é—®

### ğŸ—„ï¸ æ•°æ®å±‚ (RDSæ¨¡å—)

- **PostgreSQLæ•°æ®åº“**: ä½¿ç”¨RDSæ‰˜ç®¡çš„PostgreSQL 15
- **å­ç½‘ç»„**: è·¨å¯ç”¨åŒºéƒ¨ç½²ä»¥å®ç°é«˜å¯ç”¨æ€§
- **å‚æ•°ç»„**: é’ˆå¯¹PostgreSQLçš„æ€§èƒ½ä¼˜åŒ–é…ç½®
- **å¤‡ä»½ç­–ç•¥**: 7å¤©å¤‡ä»½ä¿ç•™æœŸå’Œç»´æŠ¤çª—å£é…ç½®

## é¡¹ç›®ç»“æ„

```text
tfboys/
â”œâ”€â”€ main.tf                    # ä¸»é…ç½®æ–‡ä»¶ï¼Œç»„è£…æ‰€æœ‰æ¨¡å—
â”œâ”€â”€ providers.tf               # AWSæä¾›å•†é…ç½®å’Œé€šç”¨æ ‡ç­¾
â”œâ”€â”€ variables.tf               # æ ¹çº§å˜é‡å®šä¹‰
â”œâ”€â”€ outputs.tf                 # è¾“å‡ºé…ç½®
â”œâ”€â”€ versions.tf                # Terraformå’Œæä¾›å•†ç‰ˆæœ¬çº¦æŸ
â”œâ”€â”€ envs/                      # ç¯å¢ƒç‰¹å®šé…ç½®
â”‚   â”œâ”€â”€ dev.tfvars            # å¼€å‘ç¯å¢ƒå˜é‡
â”‚   â””â”€â”€ prod.tfvars           # ç”Ÿäº§ç¯å¢ƒå˜é‡
â”œâ”€â”€ keys/                      # SSHå¯†é’¥å­˜å‚¨ç›®å½•
â””â”€â”€ modules/                   # å¯é‡ç”¨æ¨¡å—
    â”œâ”€â”€ vpc/                  # VPCç½‘ç»œæ¨¡å—
    â”‚   â”œâ”€â”€ main.tf
    â”‚   â”œâ”€â”€ variables.tf
    â”‚   â””â”€â”€ outputs.tf
    â”œâ”€â”€ security/             # å®‰å…¨ç»„æ¨¡å—
    â”‚   â”œâ”€â”€ main.tf
    â”‚   â”œâ”€â”€ variables.tf
    â”‚   â””â”€â”€ outputs.tf
    â”œâ”€â”€ ec2/                  # EC2è®¡ç®—æ¨¡å—
    â”‚   â”œâ”€â”€ main.tf
    â”‚   â”œâ”€â”€ keypair.tf
    â”‚   â”œâ”€â”€ variables.tf
    â”‚   â””â”€â”€ outputs.tf
    â””â”€â”€ rds/                  # RDSæ•°æ®åº“æ¨¡å—
        â”œâ”€â”€ main.tf
        â”œâ”€â”€ variables.tf
        â””â”€â”€ outputs.tf
```

## ç¯å¢ƒé…ç½®

### å¼€å‘ç¯å¢ƒ (dev)

- VPC CIDR: `10.10.0.0/16`
- å…¬æœ‰å­ç½‘: `10.10.1.0/24`, `10.10.2.0/24`
- ç§æœ‰å­ç½‘: `10.10.101.0/24`, `10.10.102.0/24`
- RDSå®ä¾‹ç±»å‹: `db.t3.micro`

### ç”Ÿäº§ç¯å¢ƒ (prod)

- VPC CIDR: `10.20.0.0/16`
- å…¬æœ‰å­ç½‘: `10.20.1.0/24`, `10.20.2.0/24`
- ç§æœ‰å­ç½‘: `10.20.101.0/24`, `10.20.102.0/24`
- RDSå®ä¾‹ç±»å‹: `db.t3.small`

## å¿«é€Ÿå¼€å§‹

### 1. å…ˆå†³æ¡ä»¶

```bash
# å®‰è£…Terraform (>= 1.6.0)
brew install terraform  # macOS
# æˆ–ä»å®˜ç½‘ä¸‹è½½: https://developer.hashicorp.com/terraform/downloads

# é…ç½®AWSå‡­æ®
aws configure
# æˆ–è®¾ç½®ç¯å¢ƒå˜é‡
export AWS_ACCESS_KEY_ID="your-access-key"
export AWS_SECRET_ACCESS_KEY="your-secret-key"
```

### 2. éƒ¨ç½²æ­¥éª¤

#### å¼€å‘ç¯å¢ƒéƒ¨ç½²

```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd tfboys

# åˆå§‹åŒ–Terraform
terraform init

# éªŒè¯é…ç½®
terraform validate

# æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’
terraform plan -var-file="envs/dev.tfvars"

# éƒ¨ç½²åŸºç¡€è®¾æ–½
terraform apply -var-file="envs/dev.tfvars"
```

#### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

```bash
# ä½¿ç”¨ç”Ÿäº§ç¯å¢ƒé…ç½®
terraform plan -var-file="envs/prod.tfvars"
terraform apply -var-file="envs/prod.tfvars"
```

### 3. è®¿é—®èµ„æº

éƒ¨ç½²å®Œæˆåï¼ŒTerraformä¼šè¾“å‡ºä»¥ä¸‹ä¿¡æ¯ï¼š

- EC2å®ä¾‹çš„å…¬ç½‘IPåœ°å€
- SSHè¿æ¥å‘½ä»¤
- æ•°æ®åº“è¿æ¥ä¿¡æ¯

```bash
# SSHè¿æ¥åˆ°EC2å®ä¾‹
ssh -i keys/tfboys-keypair-dev.pem ec2-user@<public-ip>

# ä»EC2è¿æ¥åˆ°æ•°æ®åº“
psql -h <db-endpoint> -p 5432 -U dbadmin -d appdb
```

## æŠ€æœ¯ç‰¹æ€§

### ğŸ—ï¸ æ¨¡å—åŒ–è®¾è®¡

- æ¯ä¸ªæ¨¡å—èŒè´£å•ä¸€ï¼Œä¾¿äºç»´æŠ¤å’Œé‡ç”¨
- æ¸…æ™°çš„è¾“å…¥è¾“å‡ºæ¥å£å®šä¹‰
- æ”¯æŒå¤šç¯å¢ƒéƒ¨ç½²

### ğŸ” å®‰å…¨æœ€ä½³å®è·µ

- æ•°æ®åº“éƒ¨ç½²åœ¨ç§æœ‰å­ç½‘ä¸­
- æœ€å°æƒé™åŸåˆ™çš„å®‰å…¨ç»„é…ç½®
- æ•æ„Ÿä¿¡æ¯(å¦‚å¯†ç )ä½¿ç”¨sensitiveæ ‡è®°

### ğŸ“Š å¯è§‚æµ‹æ€§

- ç»Ÿä¸€çš„èµ„æºæ ‡ç­¾ç­–ç•¥
- å®Œæ•´çš„è¾“å‡ºé…ç½®ä¾¿äºé›†æˆç›‘æ§

### âœ… ä»£ç è´¨é‡

- è¾“å…¥éªŒè¯å’Œçº¦æŸ
- ç‰ˆæœ¬é”å®šç¡®ä¿ç¯å¢ƒä¸€è‡´æ€§
- è§„èŒƒçš„æ³¨é‡Šå’Œæ–‡æ¡£

## æ¸…ç†èµ„æº

```bash
# é”€æ¯åŸºç¡€è®¾æ–½ (é¿å…äº§ç”Ÿè´¹ç”¨)
terraform destroy -var-file="envs/dev.tfvars"
```

## æ³¨æ„äº‹é¡¹

1. **æˆæœ¬æ§åˆ¶**: ç¡®ä¿ä¸ä½¿ç”¨èµ„æºæ—¶åŠæ—¶é”€æ¯ï¼Œç‰¹åˆ«æ˜¯RDSå®ä¾‹
2. **å®‰å…¨**: ç”Ÿäº§ç¯å¢ƒè¯·ä¿®æ”¹é»˜è®¤å¯†ç å¹¶ä½¿ç”¨AWS Secrets Manager
3. **å¤‡ä»½**: é‡è¦æ•°æ®è¯·åšå¥½å¤‡ä»½ç­–ç•¥
4. **ç›‘æ§**: å»ºè®®é…ç½®CloudWatchç›‘æ§å’Œå‘Šè­¦

## è´¡çŒ®æŒ‡å—

1. Forké¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. åˆ›å»ºPull Request

## è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ç”¨äºå­¦ä¹ å’Œæ¼”ç¤ºç›®çš„ã€‚

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤Issueæˆ–PRã€‚

---

## ğŸ“š å­¦ä¹ èµ„æº

- [Terraformå®˜æ–¹æ–‡æ¡£](https://www.terraform.io/docs)
- [AWSæä¾›å•†æ–‡æ¡£](https://registry.terraform.io/providers/hashicorp/aws/latest/docs)
- [Terraformæœ€ä½³å®è·µ](https://www.terraform-best-practices.com/)
